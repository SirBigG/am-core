{% extends "base.html" %}

{% load staticfiles i18n %}
{% load cache post_extras %}

{% block title %}
{% if object.meta %}{{ object.meta.title }}{% else %}{{ object.title }} |{% endif %}
{% endblock title %}

{% block meta_description %}
{% if object.meta %}{{ object.meta.description }}{% else %}{{ object.text|truncatechars:300|striptags|safe }}{% endif %}
{% endblock %}

{% block extra_meta %}
{% load post_extras %}
<meta content="{{ object.title }} | AgroMega.in.ua" property="og:title">
<meta content="{% if object.meta_description %}
                        {{ object.meta_description }}
                   {% else %}
                        {{ object.text|truncatechars:300|striptags|safe }}
                   {% endif %}" property="og:description">
<meta content="{% full_url object.photo.first.image.url %}" property="og:image">
<meta content="{% full_url object.get_absolute_url %}" property="og:url">
<meta content="AgroMega.in.ua" property="og:site_name">
<link href="{% full_url object.photo.first.image.url %}" rel="image_src"/>
{% endblock extra_meta %}

{% block second_menu %}
{% cache 3600 'second_menu' view.kwargs.parent category.slug %}
{% second_menu view.kwargs.parent object.rubric.slug %}
{% endcache %}
{% endblock second_menu %}

{% block page_title %}
{% if object.meta and obj.meta.h1 %}{{ object.meta.h1 }}{% else %}{{ object.title }}{% endif %} {% if object.country %}
<span class="flag-icon flag-icon-{{object.country.short_slug}}"></span>{% endif %}
{% endblock %}

{% block breadcrumbs %}
{% cache 3600 'breadcrumbs' view.kwargs.parent category.slug object.title %}
{% breadcrumbs object.rubric object.title %}
{% endcache %}
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div id="post-carousel" class="carousel" data-ride="carousel" data-interval="false">
            <div class="carousel-inner" role="listbox">
                {% for photo in object.photo.all%}
                {% if photo == object.photo.first %}
                <div class="carousel-item active">
                    {% else %}
                    <div class="carousel-item">
                        {% endif %}
                        <img alt="{{ object.title }}" src="{{ photo.image.url }}" class="img-rounded img-fluid"/>
                        {# Photo description #}
                        {% if photo.description %}
                        <div class="carousel-caption">
                            <h4>{{ photo.description }}</h4>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {# Controls #}
                {% if object.photo.count > 1 %}
                <a class="carousel-control-prev" href="#post-carousel" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#post-carousel" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
                {% endif %}
            </div>
        </div>
        {# Reviews block #}
        <div class="col-lg-4 col-12" style="display: none;">
            <div id="reviews" class="{{ object.slug }}"></div>
        </div>
    </div>
    <div class="h4">
    {% for tag in object.tags.all %}
        <span class="badge badge-pill badge-success mt-3 mr-1">{{tag.name}}</span>
    {% endfor %}
        </div>

    <hr>
    <div class="row">
        <div class="col-lg-12 col-12">
            <div class="text-justify">
                {{ object.text|safe }}
            </div>
            {% if object.author %}<h5>{{ object.author }}</h5>{% endif %}
            {% if object.source %}
            <div class="post-source">
                <h5>{% trans 'Source: ' %}{{ object.source }}</h5>
            </div>
            {% endif %}
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12 col-12">
            <div class="col-lg-12 col-12">
                <ul class="nav nav-pills float-left">
                    <li class="nav-item"><span class="text-success h5"><i class="fa fa-eye"></i> {{object.hits}}</span>
                    </li>
                </ul>
            </div>
            <div class="col-lg-12 col-12">
                <ul class="nav nav-pills float-right">
                    <li class="nav-item">
                        <a class="nav-link" tabindex="-1" target="Share-in-facebook"
                           onclick="window.open(this.href, 'Share-in-facebook' , 'width=400, height=400'); return false;"
                           href="https://www.facebook.com/sharer/sharer.php?u={% full_url object.get_absolute_url %}">
                            <i class="fa fa-facebook fa-2x"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div id="useful"></div>
    {% cache 900 'advert_detail_list' object.rubric.parent.slug %}
    {% post_adverts object.rubric.parent %}
    {% endcache %}


    <div class="row">
        <div class="col-lg-12 col-12">
            {# Random posts block. #}
            <div class="h5">{% trans 'Більше статтей тут:' %}</div>
            <div id="random-post-list"></div>
            {# Comments block. #}
            <div id="comment" class="{{ object.id }}"></div>
        </div>
    </div>


    <script src="{% static_version 'bundles/detail.js' %}"></script>
    {% endblock content %}
</div>
